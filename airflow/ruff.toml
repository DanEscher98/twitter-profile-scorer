# Ruff configuration - Strict Python linting
# https://docs.astral.sh/ruff/configuration/

target-version = "py312"
line-length = 100

[lint]
select = [
    # Core
    "E", "W",         # pycodestyle errors/warnings
    "F",              # Pyflakes
    "I",              # isort

    # Code quality
    "B",              # flake8-bugbear
    "C4",             # flake8-comprehensions
    "UP",             # pyupgrade
    "SIM",            # flake8-simplify
    "PERF",           # Perflint
    "FURB",           # refurb

    # Type safety (STRICT)
    "ANN",            # flake8-annotations
    "TCH",            # flake8-type-checking

    # Clean code
    "ARG",            # flake8-unused-arguments
    "PTH",            # flake8-use-pathlib
    "ERA",            # eradicate (commented-out code)

    # Pylint subset
    "PL",             # Pylint
    "RUF",            # Ruff-specific rules

    # Security
    "S",              # flake8-bandit

    # Style
    "N",              # pep8-naming
    "D",              # pydocstyle

    # Exception handling
    "TRY",            # tryceratops

    # Async
    "ASYNC",          # flake8-async
]

ignore = [
    "D100",           # Missing docstring in public module
    "D104",           # Missing docstring in public package
    "D107",           # Missing docstring in __init__
    "TRY003",         # Avoid specifying long messages outside exception class
    "PLR0913",        # Too many arguments (we use Pydantic models)
    "PLR2004",        # Magic values in comparisons (common in scoring)
    "PLC0415",        # Import not at top-level (lazy imports are intentional)
    "TC003",          # Move imports to type-checking block (over-optimization)
    "RUF012",         # Mutable ClassVar (Pydantic model_config is standard)
]

[lint.per-file-ignores]
"tests/**/*.py" = [
    "S101",           # assert allowed in tests
    "ANN",            # annotations not required in tests
    "D",              # docstrings not required in tests
    "PLR2004",        # magic values allowed in tests
    "ARG",            # unused args allowed in test fixtures
]
"dags/**/*.py" = [
    "D103",           # docstrings optional in DAG task functions
]
"**/migrations/**/*.py" = [
    "D",              # docstrings not required in migrations
    "ANN",            # annotations not required in migrations
]

[lint.pydocstyle]
convention = "google"

[lint.isort]
known-first-party = [
    "scorer_db",
    "scorer_llm",
    "scorer_twitter",
    "scorer_has",
    "scorer_utils",
]
section-order = [
    "future",
    "standard-library",
    "third-party",
    "first-party",
    "local-folder",
]
force-single-line = false
combine-as-imports = true

[lint.flake8-annotations]
allow-star-arg-any = false
mypy-init-return = true
suppress-none-returning = false

[lint.flake8-bugbear]
extend-immutable-calls = ["fastapi.Depends", "fastapi.Query"]

[lint.pylint]
max-args = 10

[format]
quote-style = "double"
indent-style = "space"
docstring-code-format = true
docstring-code-line-length = 80
